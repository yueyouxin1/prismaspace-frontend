# 像素级复刻需求说明（InputTree）

## 1. 需求目标

基于**当前项目架构**与 **shadcn-vue 组件库**，对以下目标进行**像素级复刻（Pixel-perfect）**：

* **复刻目标（来源）**：
  `reference_example\coze-studio\frontend\packages\workflow\playground\src\form-extensions\components\input-tree`
* **落地目录（本项目）**：
  `packages\workflow\playground\src\form-extensions\components\input-tree`

复刻范围包括但不限于：

* 布局、间距、字体、颜色、圆角、阴影等视觉细节
* 交互行为与状态变化（hover / focus / active / disabled / error / loading / empty）
* 操作流程、边界条件与目标保持一致

必须对齐的核心行为：

* 节点变更模式一致：`Append / Update / Delete / DeleteChildren`
* 树层级限制一致：`MAX_TREE_LEVEL = 3`，超过限制后禁用对象类新增能力
* Object 节点值类型切换一致：
  新增首个子节点时由字面量切到对象引用；子节点清空后回退字面量 `{}`
* 列宽比行为一致：`columnsRatio` 影响 Name/Value 两列 flex，并受层级缩进影响
* 折叠行为一致：`defaultCollapse`、节点展开收起、可折叠节点偏移与占位对齐
* 权限与限制一致：`readonly`、`disabled`、`topLevelReadonly`、`maxLimit`、`disableDelete`、`nthCannotDeleted`
* 空态、错误态、校验触发时机与 testId 规则一致

---

## 2. 文档类型与优先级（关键澄清）

本说明中的“相关文档”指的是**当前项目环境规范文档（必须遵循）**，不是“可选参考资料”。

实现与验收时按以下优先级执行：

1. **项目环境规范文档（强约束）**
2. **本需求说明文档**
3. **视觉/交互对照资源（用于比对复刻效果）**

冲突处理规则：

* 规范与实现细节冲突时，优先满足项目环境规范
* 对照资源与实现有差异时，以**可见线上行为**作为最终验收准则

---

## 3. 项目环境规范文档（必须遵循）

以下文档均属于当前项目环境约束，请按规范实现：

* `README.md`（仓库根目录）：项目级工程约定、脚本与协作说明
* `doc\ui-development-guidelines.md`：UI 组件选型、兜底路径与参考实现要求
* `doc\Vue通用架构与开发规范指南.md`：Vue 工程结构与编码规范
* `packages\workflow\README.md`：workflow 子包约定
* `packages\workflow\workflow-runtime-mock-guide.md`：workflow 运行时与 mock 对接约束

---

## 4. 对照资源（用于复刻比对）

以下内容用于视觉与交互对齐，不作为项目规范替代项：

* 落地目录：`packages\workflow\playground\src\form-extensions\components\input-tree`
* 参考目录：`reference_example\coze-studio\frontend\packages\workflow\playground\src\form-extensions\components\input-tree`
* 关键对照文件：
  `index.tsx`、`index.module.less`、`types.ts`、`constants.ts`、`utils.ts`、`context.ts`
* 关键子组件与 hooks：
  `components\input-header\index.tsx`
  `components\input-name\index.tsx`
  `components\input-value\index.tsx`
  `components\input-operator\index.tsx`
  `components\input-tree-node\index.tsx`
  `hooks\use-columns-style.ts`

---

## 5. 默认实现约定

* **UI 技术栈**：
  * 统一使用 **shadcn-vue** 作为基础组件
  * 缺失能力通过组合、封装或轻量补充实现（保持风格一致）
* **工程与架构**：
  * 遵循当前项目目录结构、命名与导出规范
  * 目录和职责与参考实现尽量同构，便于逐项对照
  * 不引入额外 UI 框架
* **交互与性能**：
  * 全状态覆盖（默认 / 禁用 / 错误 / 加载 / 空态 / 只读）
  * 树数据更新保持可预测，避免引用污染（更新前拷贝、提交前清理临时字段）
  * 避免无意义全量 watch，保障节点编辑和折叠场景下的渲染性能
* **实现边界**：
  * 只复刻 `input-tree` 及其直接依赖交互，不在本阶段扩展新业务能力
  * 文案、提示、按钮显隐与禁用条件以参考行为为准

---

## 6. 交付内容

### 1）实现代码

* 按项目规范完成组件 / 模块实现
* 结构清晰、可复用、可扩展
* 目标落地路径（最终交付成果）：

```text
packages\workflow\playground\src\form-extensions\components\input-tree\
```

建议最小目录如下（可按项目现状微调）：

```text
packages\workflow\playground\src\form-extensions\components\input-tree\
  index.vue
  index.module.scss（或项目约定样式文件）
  types.ts
  constants.ts
  utils.ts
  context.ts
  hooks\use-columns-style.ts
  components\input-header\index.vue
  components\input-name\index.vue
  components\input-value\index.vue
  components\input-operator\index.vue
  components\input-tree-node\index.vue
```

### 2）示例用法（必交）

在以下位置提供完整示例：

```text
apps\studio-web\src\components\playground\workflow-input-tree\WorkflowInputTreeDemo.vue
```

并在以下位置注册 demo：

```text
apps\studio-web\src\data\component-demos.ts
```

示例需覆盖：

* 核心功能：根节点增删改、对象节点子节点增删、批量编辑回写
* 关键交互：折叠/展开、列宽比例、层级限制、对象类型切换
* 全状态展示：`readonly` / `disabled` / `topLevelReadonly` / `maxLimit` / 空态 / 错误态

### 3）验收清单（执行项）

* 视觉对齐：结构、间距、字号、边框、hover/focus 效果逐项截图比对
* 交互对齐：新增、删除、删除子节点、折叠展开、禁用态操作一致
* 边界对齐：空值、单节点、多层节点、对象与非对象切换、层级上限
* 回归验证：示例页手测通过，且不破坏现有 workflow 相关组件行为

---

## 7. 验收标准（一句话版）

> **在不看代码的情况下，肉眼与交互上无法区分本项目 InputTree 实现与目标参考。**
