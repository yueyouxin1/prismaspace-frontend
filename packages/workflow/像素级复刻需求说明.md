# 像素级复刻需求说明（Workflow）

## 1. 需求目标

基于**当前项目架构**与 **shadcn-vue 组件库**，对以下目标进行**像素级复刻（Pixel-perfect）**：

* **复刻目标（来源）**：
  `reference_example\coze-studio\frontend\packages\workflow`
* **落地目录（本项目）**：
  `packages\workflow`

复刻范围包括但不限于：

* 布局、间距、字体、颜色、圆角、阴影等视觉细节
* 交互行为与状态变化（hover / focus / active / disabled / error / loading / empty）
* 操作流程、边界条件与目标保持一致

必须对齐的核心行为：

* 画布编辑区行为一致：节点拖拽、连线、选中、缩放、平移、框选
* 右侧配置面板行为一致：节点切换联动、字段编辑回写、校验提示
* 顶部/底部工作流操作区行为一致：保存状态、发布入口、试运行入口、缩放控制
* 子流程与分支可视化一致：分支命中路径、容器边界、连线走向与层级关系
* 运行时联调能力一致：基于 Mock 契约完成执行结果回放与状态展示
* 示例截图（`packages\workflow\示例效果.jpeg`）中的整体布局与信息密度保持一致

---

## 2. 文档类型与优先级（关键澄清）

本说明中的“相关文档”指的是**当前项目环境规范文档（必须遵循）**，不是“可选参考资料”。

实现与验收时按以下优先级执行：

1. **项目环境规范文档（强约束）**
2. **本需求说明文档**
3. **视觉/交互对照资源（用于比对复刻效果）**

冲突处理规则：

* 规范与实现细节冲突时，优先满足项目环境规范
* 对照资源与实现有差异时，以**可见线上行为**作为最终验收准则

---

## 3. 项目环境规范文档（必须遵循）

以下文档均属于当前项目环境约束，请按规范实现：

* `README.md`（仓库根目录）：项目级工程约定、脚本与协作说明
* `doc\ui-development-guidelines.md`：UI 组件选型、兜底路径与参考实现要求
* `doc\Vue通用架构与开发规范指南.md`：Vue 工程结构与编码规范
* `packages\workflow\README.md`：workflow 子包约定
* `packages\workflow\workflow-runtime-mock-guide.md`：Workflow 运行时契约与前端 Mock 约束

---

## 4. 对照资源（用于复刻比对）

以下内容用于视觉与交互对齐，不作为项目规范替代项：

* 落地目录：`packages\workflow`
* 参考目录：`reference_example\coze-studio\frontend\packages\workflow`
* 补充视觉对照：`packages\workflow\示例效果.jpeg`
* 重点对照子模块（建议优先级）：
  `playground`（整体编排与编辑器体验）
  `fabric-canvas`（画布交互与视口）
  `nodes`（节点配置与校验）
  `render`（连线与渲染层）
  `base`（图结构与状态基础能力）
  `test-run` / `test-run-next`（运行态面板与结果展示）

---

## 5. 默认实现约定

* **UI 技术栈**：
  * 统一使用 **shadcn-vue** 作为基础组件
  * 缺失能力通过组合、封装或轻量补充实现（保持风格一致）
* **工程与架构**：
  * 遵循当前项目目录结构、命名与导出规范
  * 不引入额外 UI 框架
  * workflow 包内按“基础层-渲染层-节点层-playground 编排层”分层组织
* **运行时契约**：
  * 图结构、节点 schema、参数 schema、执行事件严格遵循
    `packages\workflow\workflow-runtime-mock-guide.md`
  * 当前节点注册范围默认对齐文档中 8 类节点（Start/Output/End/Branch/Loop/LLMNode/AgentNode/ToolNode）
  * Mock 数据必须满足 DAG、单 Start/单 End、ref 引用合法性等约束
* **交互与性能**：
  * 全状态覆盖（默认 / 禁用 / 错误 / 加载 / 空态 / 只读）
  * 避免无意义全量 watch，保障画布操作与配置编辑流畅度
  * 面板编辑回写需稳定可追踪，避免出现脏写与竞态覆盖

---

## 6. 交付内容

### 1）实现代码

* 按项目规范完成 workflow 复刻代码落地
* 结构清晰、可复用、可扩展
* 目标落地路径（最终交付成果）：

```text
packages\workflow\
```

建议最小目录如下（可按项目现状微调）：

```text
packages\workflow\
  src\
    base\
    render\
    nodes\
    components\
  playground\
    src\
      editor\
      panels\
      test-run\
```

### 2）示例用法（必交）

在以下位置提供完整示例：

```text
apps\studio-web\src\components\playground\workflow\WorkflowStudioDemo.vue
```

并在以下位置注册 demo：

```text
apps\studio-web\src\data\component-demos.ts
```

示例需覆盖：

* 核心功能：节点增删改、连线、节点配置编辑、基础校验
* 关键交互：画布缩放平移、节点选中联动右侧面板、试运行触发与状态回放
* 全状态展示：空图、加载中、错误态、禁用态、只读态、运行中态

### 3）验收清单（执行项）

* 视觉对齐：对照 `packages\workflow\示例效果.jpeg` 进行截图比对
* 交互对齐：连线、拖拽、配置回写、发布/试运行操作链路一致
* 契约对齐：Mock 输入输出、SSE/WS 事件序列、节点状态与运行时文档一致
* 回归验证：workflow demo 可独立运行，且不破坏现有 `input-tree` 相关能力

---

## 7. 验收标准（一句话版）

> **在不看代码的情况下，肉眼与交互上无法区分本项目 Workflow 实现与目标参考。**

